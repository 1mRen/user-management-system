import{a as N}from"./chunk-7KBLVN73.js";import{a as w,b as P,e as L}from"./chunk-YOZUUFLZ.js";import{$ as A,A as n,Aa as re,B as i,C as v,Ca as oe,Ea as ge,F as b,Fa as ve,G as _,H as m,Ha as he,I as ue,Ia as _e,Ja as se,Ka as F,L as s,M as S,Ma as ae,N as h,T as pe,U as E,W as k,X as V,Y as G,a as ce,aa as R,b as me,ba as M,ca as U,da as H,ea as fe,fa as q,ga as O,j as I,ma as z,n as B,na as C,oa as Y,p as T,pa as Q,q as $,r as y,ra as J,s as x,sa as W,ta as K,u as a,ua as X,v as g,va as Z,w as p,wa as ee,x as d,xa as te,ya as ie,za as ne}from"./chunk-ZYNGRVCC.js";var ye=(()=>{class t{static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275cmp=T({type:t,selectors:[["ng-component"]],decls:2,vars:0,consts:[[1,"content"]],template:function(o,r){o&1&&(n(0,"div",0),v(1,"router-outlet"),i())},dependencies:[_e],styles:[".content[_ngcontent-%COMP%]{padding:1rem}"]})}}return t})();var Ne=t=>["/requests/edit",t];function ke(t,c){t&1&&(n(0,"div",6),v(1,"div",7),n(2,"p"),s(3,"Loading requests..."),i()())}function Ae(t,c){if(t&1){let e=b();n(0,"div",8)(1,"p"),s(2,"Error loading requests. This could be due to an authentication issue or server problem."),i(),n(3,"button",9),_("click",function(){y(e);let r=m();return x(r.retryLoading())}),s(4,"Retry Loading"),i()()}}function Re(t,c){t&1&&(n(0,"div",10)(1,"p"),s(2,"No employee record is associated with your account. Please contact an administrator to set up your employee profile."),i()())}function Me(t,c){t&1&&(n(0,"div",10)(1,"p"),s(2,"You don't have any requests yet."),i()())}function Oe(t,c){if(t&1&&(n(0,"div")(1,"strong"),s(2,"Items:"),i(),s(3),i()),t&2){let e=m().$implicit,o=m(2);a(3),h(" ",o.getItemsDescription(e)," ")}}function Fe(t,c){if(t&1&&(n(0,"div")(1,"strong"),s(2,"Days:"),i(),s(3),i()),t&2){let e=m().$implicit,o=m(2);a(3),h(" ",o.getItemsDescription(e)," ")}}function Pe(t,c){if(t&1&&(n(0,"div"),s(1),i()),t&2){let e=m().$implicit;a(),h(" ",e.description||"No description provided"," ")}}function Le(t,c){if(t&1&&(n(0,"a",17),v(1,"i",18),s(2," Edit "),i()),t&2){let e=m().$implicit;d("routerLink",E(1,Ne,e.id))}}function Ve(t,c){if(t&1&&(n(0,"tr")(1,"td"),s(2),k(3,"titlecase"),i(),n(4,"td"),s(5),i(),n(6,"td"),s(7),k(8,"date"),i(),n(9,"td")(10,"span",15),s(11),k(12,"titlecase"),i()(),n(13,"td"),p(14,Oe,4,1,"div",14)(15,Fe,4,1,"div",14)(16,Pe,2,1,"div",14),i(),n(17,"td"),p(18,Le,3,3,"a",16),i()()),t&2){let e=c.$implicit,o=m(2);a(2),S(V(3,9,e.type)),a(3),S(e.title),a(2),S(G(8,11,e.created,"M/d/yyyy")),a(3),d("ngClass",o.getStatusClass(e.status)),a(),h(" ",V(12,14,e.status)," "),a(3),d("ngIf",e.type==="equipment"||e.type==="resources"),a(),d("ngIf",e.type==="leave"),a(),d("ngIf",e.type!=="equipment"&&e.type!=="resources"&&e.type!=="leave"),a(2),d("ngIf",e.status.toLowerCase()==="pending")}}function De(t,c){t&1&&(n(0,"tr")(1,"td",19)(2,"span"),s(3,"No requests found"),i()()())}function je(t,c){if(t&1&&(n(0,"div",11)(1,"table",12)(2,"thead")(3,"tr")(4,"th"),s(5,"Type"),i(),n(6,"th"),s(7,"Title"),i(),n(8,"th"),s(9,"Date"),i(),n(10,"th"),s(11,"Status"),i(),n(12,"th"),s(13,"Details"),i(),n(14,"th"),s(15,"Actions"),i()()(),n(16,"tbody"),p(17,Ve,19,16,"tr",13)(18,De,4,0,"tr",14),i()()()),t&2){let e=m();a(17),d("ngForOf",e.requests),a(),d("ngIf",e.requests.length===0)}}var Se=(()=>{class t{constructor(e,o,r,l){this.requestService=e,this.accountService=o,this.alertService=r,this.http=l,this.requests=[],this.loading=!1,this.hasEmployeeRecord=!0,this.loadError=!1,console.log("Request list component constructed")}ngOnInit(){console.log("Request list component initialized"),this.loading=!0;let e=this.accountService.accountValue;if(!e){this.alertService.error("You must be logged in to view requests"),this.loading=!1,this.loadError=!0;return}this.accountId=e.id,console.log("AccountID found:",this.accountId),this.fetchEmployeeByAccountId()}fetchEmployeeByAccountId(){if(console.log("Fetching employee record"),!this.accountId){console.error("No account ID available"),this.loading=!1,this.loadError=!0;return}let e=this.accountService.accountValue;if(!e||!e.jwtToken){console.error("No authentication token available"),this.alertService.error("Authentication required. Please log in again."),this.loading=!1,this.loadError=!0;return}let o={headers:new q({Authorization:`Bearer ${e.jwtToken}`,"Content-Type":"application/json"}),withCredentials:!0};this.http.get(`${w.apiUrl}/employees`,o).pipe(I()).subscribe({next:r=>{console.log("Employees data received:",r);let l=Number(this.accountId),f=r.find(u=>Number(u.accountId)===l);f?(console.log("Found employee record:",f),this.employeeId=f.id,this.hasEmployeeRecord=!0,this.loadRequests()):(console.log("No employee record found"),this.hasEmployeeRecord=!1,this.loading=!1)},error:r=>{console.error("Error fetching employee data:",r),r.status===401?this.alertService.error("Authentication failed. Please log in again."):this.alertService.error("Failed to load employee data: "+(r.message||"Unknown error")),this.hasEmployeeRecord=!1,this.loading=!1,this.loadError=!0}})}loadRequests(){if(console.log("Loading requests for employeeId:",this.employeeId),!this.employeeId){console.error("No employee ID available"),this.loading=!1,this.loadError=!0;return}let e=`${w.apiUrl}/requests/employee/${this.employeeId}`,o=this.accountService.accountValue;if(!o||!o.jwtToken){console.error("No authentication token available"),this.alertService.error("Authentication required. Please log in again."),this.loading=!1,this.loadError=!0;return}let r={headers:new q({Authorization:`Bearer ${o.jwtToken}`,"Content-Type":"application/json"}),withCredentials:!0};this.http.get(e,r).pipe(I()).subscribe({next:l=>{console.log("My requests received:",l),this.requests=l.map(f=>me(ce({},f),{created:new Date(f.created)})),this.loading=!1},error:l=>{console.error("Error loading requests:",l),l.status===401?this.alertService.error("Authentication failed. Please log in again."):this.alertService.error("Failed to load requests: "+(l.message||"Unknown error")),this.loading=!1,this.loadError=!0}})}retryLoading(){console.log("Retrying data load"),this.loading=!0,this.loadError=!1,this.employeeId?this.loadRequests():this.fetchEmployeeByAccountId()}getStatusClass(e){switch(e.toLowerCase()){case"approved":return"status-success";case"rejected":return"status-danger";case"pending":return"status-warning";case"completed":return"status-success";case"cancelled":return"status-danger";default:return"status-info"}}getItemsDescription(e){return!e.details||!e.details.items||!e.details.items.length?"No items specified":e.details.items.map(o=>`${o.name} (${o.quantity})`).join(", ")}static{this.\u0275fac=function(o){return new(o||t)(g(N),g(P),g(L),g(O))}}static{this.\u0275cmp=T({type:t,selectors:[["ng-component"]],decls:10,vars:5,consts:[["class","text-center mb-3",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],["class","alert alert-info",4,"ngIf"],["class","table-responsive",4,"ngIf"],[1,"mt-3"],["routerLink","/requests/add",1,"btn","btn-success"],[1,"text-center","mb-3"],[1,"spinner-border","spinner-border-lg","align-center"],[1,"alert","alert-danger"],[1,"btn","btn-outline-primary","mt-2",3,"click"],[1,"alert","alert-info"],[1,"table-responsive"],[1,"table","table-bordered"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"status-badge",3,"ngClass"],["class","btn btn-sm btn-primary",3,"routerLink",4,"ngIf"],[1,"btn","btn-sm","btn-primary",3,"routerLink"],[1,"fas","fa-edit"],["colspan","6",1,"text-center"]],template:function(o,r){o&1&&(n(0,"h1"),s(1,"My Requests"),i(),p(2,ke,4,0,"div",0)(3,Ae,5,0,"div",1)(4,Re,3,0,"div",2)(5,Me,3,0,"div",2)(6,je,19,2,"div",3),n(7,"div",4)(8,"a",5),s(9,"Create New Request"),i()()),o&2&&(a(2),d("ngIf",r.loading),a(),d("ngIf",r.loadError),a(),d("ngIf",!r.loading&&!r.loadError&&!r.hasEmployeeRecord),a(),d("ngIf",!r.loading&&!r.loadError&&r.hasEmployeeRecord&&r.requests.length===0),a(),d("ngIf",!r.loading&&!r.loadError&&r.hasEmployeeRecord))},dependencies:[A,R,M,F,U,H],styles:[`.table[_ngcontent-%COMP%] {
        margin-bottom: 0;
    }
    .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%] {
        background-color: #f8f9fa;
        font-weight: bold;
    }
    .table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%] {
        padding: 0.75rem;
        vertical-align: middle;
        border: 1px solid #dee2e6;
    }
    .status-badge[_ngcontent-%COMP%] {
        display: inline-block;
        padding: 0.4rem 0.6rem;
        border-radius: 0.25rem;
        color: white;
        text-align: center;
        min-width: 5rem;
    }
    .status-success[_ngcontent-%COMP%] {
        background-color: #28a745;
    }
    .status-warning[_ngcontent-%COMP%] {
        background-color: #ffc107;
        color: #212529;
    }
    .status-danger[_ngcontent-%COMP%] {
        background-color: #dc3545;
    }
    .status-info[_ngcontent-%COMP%] {
        background-color: #17a2b8;
    }
    .mt-2[_ngcontent-%COMP%] {
        margin-top: 0.5rem;
    }
    .mt-3[_ngcontent-%COMP%] {
        margin-top: 1rem;
    }
    .mb-3[_ngcontent-%COMP%] {
        margin-bottom: 1rem;
    }
    .btn-success[_ngcontent-%COMP%] {
        background-color: #28a745;
        color: white;
        border: none;
    }
    .btn-primary[_ngcontent-%COMP%] {
        background-color: #007bff;
        color: white;
        border: none;
    }
    .table-responsive[_ngcontent-%COMP%] {
        overflow-x: auto;
    }`]})}}return t})();var Ee=t=>({"is-invalid":t});function $e(t,c){if(t&1&&(n(0,"option",18),s(1),i()),t&2){let e=c.$implicit;d("value",e.value),a(),S(e.label)}}function Ge(t,c){t&1&&(n(0,"div"),s(1,"Request type is required"),i())}function Ue(t,c){if(t&1&&(n(0,"div",19),p(1,Ge,2,0,"div",20),i()),t&2){let e=m();a(),d("ngIf",e.f.type.errors.required)}}function He(t,c){t&1&&(n(0,"div"),s(1,"Title is required"),i())}function ze(t,c){if(t&1&&(n(0,"div",19),p(1,He,2,0,"div",20),i()),t&2){let e=m();a(),d("ngIf",e.f.title.errors.required)}}function Ye(t,c){if(t&1){let e=b();n(0,"div",26)(1,"div",27)(2,"label"),s(3,"Leave Type"),i(),n(4,"select",28)(5,"option",29),s(6,"Vacation"),i(),n(7,"option",30),s(8,"Sick"),i(),n(9,"option",31),s(10,"Personal"),i(),n(11,"option",32),s(12,"Bereavement"),i(),n(13,"option",33),s(14,"Other"),i()()(),n(15,"div",34)(16,"label"),s(17,"Number of Days"),i(),v(18,"input",35),i(),n(19,"div",36)(20,"button",37),_("click",function(){let r=y(e).index,l=m(2);return x(l.removeItem(r))}),s(21,"Remove"),i()()()}if(t&2){let e=c.index;d("formGroupName",e)}}function Qe(t,c){if(t&1){let e=b();n(0,"div",21)(1,"h4"),s(2,"Leave Details"),i(),n(3,"div",22)(4,"div",23),p(5,Ye,22,1,"div",24),i()(),n(6,"button",25),_("click",function(){y(e);let r=m();return x(r.addItem())}),s(7,"Add More Leave"),i()()}if(t&2){let e=m();a(5),d("ngForOf",e.items.controls)}}function Je(t,c){if(t&1){let e=b();n(0,"div",26)(1,"div",27)(2,"label"),s(3,"Item Name"),i(),v(4,"input",39),i(),n(5,"div",34)(6,"label"),s(7,"Quantity"),i(),v(8,"input",35),i(),n(9,"div",36)(10,"button",37),_("click",function(){let r=y(e).index,l=m(2);return x(l.removeItem(r))}),s(11,"Remove"),i()()()}if(t&2){let e=c.index;d("formGroupName",e)}}function We(t,c){if(t&1){let e=b();n(0,"div",38)(1,"h4"),s(2),i(),n(3,"div",22)(4,"div",23),p(5,Je,12,1,"div",24),i()(),n(6,"button",25),_("click",function(){y(e);let r=m();return x(r.addItem())}),s(7,"Add Another Item"),i()()}if(t&2){let e=m();a(2),h("",e.currentType==="equipment"?"Equipment":"Resources"," Details"),a(3),d("ngForOf",e.items.controls)}}function Ke(t,c){t&1&&(n(0,"div",3)(1,"label",40),s(2,"Description"),i(),v(3,"textarea",41),i())}function Xe(t,c){t&1&&v(0,"span",42)}var qe=(()=>{class t{constructor(e,o,r,l,f,u){this.formBuilder=e,this.router=o,this.requestService=r,this.accountService=l,this.alertService=f,this.http=u,this.loading=!1,this.submitted=!1,this.loadError=!1,this.requestTypes=[{value:"leave",label:"Leave Request"},{value:"equipment",label:"Equipment Request"},{value:"resources",label:"Resources Request"},{value:"other",label:"Other Request"}],this.currentType=""}ngOnInit(){console.log("Add request component initialized"),this.form=this.formBuilder.group({type:["",C.required],title:["",C.required],description:[""],details:this.formBuilder.group({items:this.formBuilder.array([])})}),console.log("Initial form structure:",this.form),console.log("Items FormArray exists:",this.form.get("details.items")!==null),this.form.get("type")?.valueChanges.subscribe(o=>{this.currentType=o,this.resetItems(),(o==="leave"||o==="equipment"||o==="resources")&&this.addItem()});let e=this.accountService.accountValue?.id;e?(console.log("AccountID found:",e),this.fetchEmployeeByAccountId(e)):(this.loadError=!0,this.alertService.error("Account information not available"))}fetchEmployeeByAccountId(e){let o=this.accountService.accountValue,r={headers:new q({"Content-Type":"application/json",Authorization:`Bearer ${o?.jwtToken}`}),withCredentials:!0};this.http.get(`${w.apiUrl}/employees`,r).pipe(I()).subscribe({next:l=>{console.log("All employees:",l);let f=parseInt(e||"0"),u=l.find(j=>j.accountId===f||String(j.accountId)===e);u?(console.log("Found employee record:",u),this.employeeId=u.id):(console.log("No employee record found for account ID:",e),this.alertService.warn("Your account is not linked to an employee record. Please contact an administrator."))},error:l=>{console.error("Error fetching employees:",l),this.alertService.warn("Authentication error. Please try logging out and back in.")}})}get f(){return this.form.controls}get items(){let e=this.form.get("details");return e?e.get("items"):(console.error("Details form group not found"),this.formBuilder.array([]))}addItem(){try{console.log("Adding item, current items length:",this.items.length),this.items.push(this.formBuilder.group({name:["",C.required],quantity:[1,[C.required,C.min(1)]]})),console.log("Item added, new items length:",this.items.length)}catch(e){console.error("Error adding item:",e),this.alertService.error("Error adding item to form")}}removeItem(e){try{this.items.removeAt(e)}catch(o){console.error("Error removing item:",o)}}resetItems(){try{for(;this.items.length;)this.items.removeAt(0)}catch(e){console.error("Error resetting items:",e)}}onSubmit(){if(this.submitted=!0,this.alertService.clear(),console.log("Form state on submit:",this.form.value),console.log("Form valid?",this.form.valid),this.form.get("details.items")?.invalid&&console.error("Items are invalid:",this.form.get("details.items")),this.form.invalid)return;if(!this.employeeId){this.alertService.error("Cannot submit request: No employee ID available");return}this.loading=!0;let e={employeeId:this.employeeId,type:this.form.value.type,title:this.form.value.title,status:"pending"};if(this.form.value.type==="other"){if(!this.form.value.description){this.alertService.error("Description is required for this request type"),this.loading=!1;return}e.description=this.form.value.description}else e.description=this.form.value.description||"New request";if(["equipment","resources","leave"].includes(this.form.value.type)){if(e.items=this.form.value.details?.items||[],!e.items||e.items.length===0){this.alertService.error(`Please add at least one item to your ${this.form.value.type} request`),this.loading=!1;return}}else e.details=this.form.value.details||{};console.log("Submitting request with data:",e),this.requestService.create(e).pipe(I()).subscribe({next:()=>{this.alertService.success("Request created successfully",{keepAfterRouteChange:!0}),this.router.navigate(["/requests"])},error:o=>{console.error("Error creating request:",o),this.alertService.error(o),this.loading=!1}})}static{this.\u0275fac=function(o){return new(o||t)(g(oe),g(se),g(N),g(P),g(L),g(O))}}static{this.\u0275cmp=T({type:t,selectors:[["ng-component"]],decls:27,vars:15,consts:[[1,"card"],[1,"card-body"],[3,"ngSubmit","formGroup"],[1,"form-group"],["for","type"],["id","type","formControlName","type",1,"form-control",3,"ngClass"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","invalid-feedback",4,"ngIf"],["for","title"],["type","text","id","title","formControlName","title",1,"form-control",3,"ngClass"],["class","leave-section",4,"ngIf"],["class","item-section",4,"ngIf"],["class","form-group",4,"ngIf"],[1,"form-group","mt-4"],["type","submit",1,"btn","btn-primary",3,"disabled"],["class","spinner-border spinner-border-sm mr-1",4,"ngIf"],["routerLink","/requests",1,"btn","btn-link"],[3,"value"],[1,"invalid-feedback"],[4,"ngIf"],[1,"leave-section"],["formGroupName","details"],["formArrayName","items"],["class","form-row mb-2",3,"formGroupName",4,"ngFor","ngForOf"],["type","button",1,"btn","btn-info","btn-sm","mt-2",3,"click"],[1,"form-row","mb-2",3,"formGroupName"],[1,"col-md-6"],["formControlName","name",1,"form-control"],["value","Vacation"],["value","Sick"],["value","Personal"],["value","Bereavement"],["value","Other"],[1,"col-md-4"],["type","number","formControlName","quantity","min","1",1,"form-control"],[1,"col-md-2","d-flex","align-items-end"],["type","button",1,"btn","btn-danger","btn-sm",3,"click"],[1,"item-section"],["type","text","formControlName","name",1,"form-control"],["for","description"],["id","description","formControlName","description","rows","4",1,"form-control"],[1,"spinner-border","spinner-border-sm","mr-1"]],template:function(o,r){o&1&&(n(0,"h1"),s(1,"Create New Request"),i(),n(2,"div",0)(3,"div",1)(4,"form",2),_("ngSubmit",function(){return r.onSubmit()}),n(5,"div",3)(6,"label",4),s(7,"Request Type"),i(),n(8,"select",5)(9,"option",6),s(10,"-- Select Type --"),i(),p(11,$e,2,2,"option",7),i(),p(12,Ue,2,1,"div",8),i(),n(13,"div",3)(14,"label",9),s(15,"Title"),i(),v(16,"input",10),p(17,ze,2,1,"div",8),i(),p(18,Qe,8,1,"div",11)(19,We,8,2,"div",12)(20,Ke,4,0,"div",13),n(21,"div",14)(22,"button",15),p(23,Xe,1,0,"span",16),s(24," Submit Request "),i(),n(25,"a",17),s(26,"Cancel"),i()()()()()),o&2&&(a(4),d("formGroup",r.form),a(4),d("ngClass",E(11,Ee,r.submitted&&r.f.type.errors)),a(3),d("ngForOf",r.requestTypes),a(),d("ngIf",r.submitted&&r.f.type.errors),a(4),d("ngClass",E(13,Ee,r.submitted&&r.f.title.errors)),a(),d("ngIf",r.submitted&&r.f.title.errors),a(),d("ngIf",r.currentType==="leave"),a(),d("ngIf",r.currentType==="equipment"||r.currentType==="resources"),a(),d("ngIf",r.currentType==="other"),a(2),d("disabled",r.loading),a(),d("ngIf",r.loading))},dependencies:[A,R,M,J,ie,ne,z,W,te,Y,Q,re,K,ee,X,Z,F],styles:[`.form-row[_ngcontent-%COMP%] {
        display: flex;
        margin-right: -5px;
        margin-left: -5px;
    }
    .col-md-6[_ngcontent-%COMP%], .col-md-4[_ngcontent-%COMP%], .col-md-2[_ngcontent-%COMP%] {
        padding-right: 5px;
        padding-left: 5px;
    }
    .col-md-6[_ngcontent-%COMP%] {
        flex: 0 0 50%;
        max-width: 50%;
    }
    .col-md-4[_ngcontent-%COMP%] {
        flex: 0 0 33.333333%;
        max-width: 33.333333%;
    }
    .col-md-2[_ngcontent-%COMP%] {
        flex: 0 0 16.666667%;
        max-width: 16.666667%;
    }
    .d-flex[_ngcontent-%COMP%] {
        display: flex;
    }
    .align-items-end[_ngcontent-%COMP%] {
        align-items: flex-end;
    }
    .mb-2[_ngcontent-%COMP%] {
        margin-bottom: 0.5rem;
    }
    .mt-2[_ngcontent-%COMP%] {
        margin-top: 0.5rem;
    }
    .mt-4[_ngcontent-%COMP%] {
        margin-top: 1.5rem;
    }`]})}}return t})();var de=t=>({"is-invalid":t}),Ze=()=>["equipment","resources","leave"];function et(t,c){t&1&&(n(0,"div",3),v(1,"div",4),i())}function tt(t,c){t&1&&(n(0,"div",5)(1,"p"),s(2,"Unable to load request data. The request may no longer exist or you may not have permission to edit it."),i(),n(3,"a",6),s(4,"Back to Requests"),i()())}function it(t,c){t&1&&(n(0,"div"),s(1,"Title is required"),i())}function nt(t,c){if(t&1&&(n(0,"div",33),p(1,it,2,0,"div",34),i()),t&2){let e=m(2);a(),d("ngIf",e.f.title.errors.required)}}function rt(t,c){if(t&1){let e=b();n(0,"button",48),_("click",function(){y(e);let r=m().index,l=m(3);return x(l.removeItem(r))}),s(1," Remove "),i()}}function ot(t,c){if(t&1&&(n(0,"div"),s(1),i()),t&2){let e=m(5);a(),h(" ",(e.request==null?null:e.request.type)==="leave"?"Leave type":"Item name"," is required ")}}function st(t,c){if(t&1&&(n(0,"div",33),p(1,ot,2,1,"div",34),i()),t&2){let e,o=m().index,r=m(3);a(),d("ngIf",(e=r.items.controls[o].get("name"))==null||e.errors==null?null:e.errors.required)}}function at(t,c){if(t&1&&(n(0,"div"),s(1),i()),t&2){let e=m(5);a(),h(" ",(e.request==null?null:e.request.type)==="leave"?"Number of days":"Quantity"," is required ")}}function lt(t,c){t&1&&(n(0,"div"),s(1," Minimum value is 1 "),i())}function dt(t,c){if(t&1&&(n(0,"div",33),p(1,at,2,1,"div",34)(2,lt,2,0,"div",34),i()),t&2){let e,o,r=m().index,l=m(3);a(),d("ngIf",(e=l.items.controls[r].get("quantity"))==null||e.errors==null?null:e.errors.required),a(),d("ngIf",(o=l.items.controls[r].get("quantity"))==null||o.errors==null?null:o.errors.min)}}function ct(t,c){if(t&1&&(n(0,"div",39)(1,"div",40)(2,"div",41)(3,"h5",42),s(4),i(),p(5,rt,2,0,"button",43),i(),n(6,"div",17)(7,"div",44)(8,"label"),s(9),i(),v(10,"input",45),p(11,st,2,1,"div",20),i(),n(12,"div",46)(13,"label"),s(14),i(),v(15,"input",47),p(16,dt,3,2,"div",20),i()()()()),t&2){let e,o,r,l,f=c.index,u=m(3);a(),d("formGroupName",f),a(3),h("Item #",f+1,""),a(),d("ngIf",u.items.length>1),a(4),S((u.request==null?null:u.request.type)==="leave"?"Leave Type":"Item Name"),a(),ue("placeholder",(u.request==null?null:u.request.type)==="leave"?"e.g., Vacation, Sick, Personal":"Enter item name"),d("ngClass",E(10,de,u.submitted&&((e=u.items.controls[f].get("name"))==null?null:e.errors))),a(),d("ngIf",u.submitted&&((o=u.items.controls[f].get("name"))==null?null:o.errors)),a(3),S((u.request==null?null:u.request.type)==="leave"?"Days":"Quantity"),a(),d("ngClass",E(12,de,u.submitted&&((r=u.items.controls[f].get("quantity"))==null?null:r.errors))),a(),d("ngIf",u.submitted&&((l=u.items.controls[f].get("quantity"))==null?null:l.errors))}}function mt(t,c){if(t&1){let e=b();n(0,"div",35)(1,"h4"),s(2),i(),n(3,"div",36),p(4,ct,17,14,"div",37),n(5,"button",38),_("click",function(){y(e);let r=m(2);return x(r.addItem())}),s(6),i()()()}if(t&2){let e=m(2);a(2),h(" ",(e.request==null?null:e.request.type)==="leave"?"Leave":(e.request==null?null:e.request.type)==="equipment"?"Equipment":"Resources"," Items "),a(2),d("ngForOf",e.items.controls),a(2),h(" Add ",(e.request==null?null:e.request.type)==="leave"?"Leave Period":"Item"," ")}}function ut(t,c){t&1&&v(0,"span",49)}function pt(t,c){if(t&1){let e=b();n(0,"div",7)(1,"div",8)(2,"div",9)(3,"h2",10),s(4),i(),n(5,"span",11),s(6),i()()(),n(7,"div",12)(8,"div",13)(9,"div",14)(10,"div",15)(11,"h4"),s(12,"Request Information"),i(),n(13,"p")(14,"strong"),s(15,"Type:"),i(),s(16),k(17,"titlecase"),i(),n(18,"p")(19,"strong"),s(20,"Date Created:"),i(),s(21),k(22,"date"),i()()()(),n(23,"form",16),_("ngSubmit",function(){y(e);let r=m();return x(r.onSubmit())}),n(24,"div",17)(25,"div",18)(26,"label"),s(27,"Request Title"),i(),v(28,"input",19),p(29,nt,2,1,"div",20),i(),n(30,"div",18)(31,"label"),s(32,"Priority"),i(),n(33,"select",21)(34,"option",22),s(35,"Low"),i(),n(36,"option",23),s(37,"Medium"),i(),n(38,"option",24),s(39,"High"),i(),n(40,"option",25),s(41,"Urgent"),i()()()(),n(42,"div",26)(43,"label"),s(44,"Description"),i(),v(45,"textarea",27),i(),p(46,mt,7,3,"div",28),n(47,"div",29)(48,"button",30),p(49,ut,1,0,"span",31),s(50," Save Changes "),i(),n(51,"a",32),s(52,"Cancel"),i()()()()()}if(t&2){let e=m();a(4),h("Request #",e.request.id,""),a(),d("ngClass",e.getStatusClass((e.request==null?null:e.request.status)||"")),a(),h(" ",e.request==null?null:e.request.status," "),a(10),h(" ",V(17,11,e.request.type),""),a(5),h(" ",G(22,13,e.request.created,"medium"),""),a(2),d("formGroup",e.form),a(5),d("ngClass",E(16,de,e.submitted&&e.f.title.errors)),a(),d("ngIf",e.submitted&&e.f.title.errors),a(17),d("ngIf",pe(18,Ze).includes((e.request==null?null:e.request.type)||"")),a(2),d("disabled",e.loading),a(),d("ngIf",e.loading)}}var we=(()=>{class t{constructor(e,o,r,l,f,u,j){this.formBuilder=e,this.route=o,this.router=r,this.requestService=l,this.alertService=f,this.accountService=u,this.http=j,this.loading=!1,this.submitted=!1,this.request=null,console.log("==================== EditComponent constructor called ===================="),this.id=this.route.snapshot.params.id,console.log("Request ID from route:",this.id),console.log("All route params:",this.route.snapshot.params),console.log("Route URL:",this.route.snapshot.url),console.log("Parent Route:",this.route.parent?.snapshot.url),this.form=this.formBuilder.group({title:["",C.required],description:[""],priority:["medium"],details:this.formBuilder.group({items:this.formBuilder.array([])})}),console.log("Form initialized:",this.form)}ngOnInit(){if(console.log("==================== EditComponent ngOnInit called ===================="),console.log(`Current URL: ${window.location.href}`),this.route.snapshot.data&&console.log("Route data:",this.route.snapshot.data),!this.id){console.error("No ID found in route parameters"),this.alertService.error("Request ID is missing"),this.router.navigate(["/requests"]);return}let e=this.accountService.accountValue;if(!e){console.error("No account found in accountService"),this.alertService.error("You must be logged in to edit requests"),this.router.navigate(["/account/login"]);return}this.accountId=e.id,console.log("Account ID found:",this.accountId),console.log("Account object:",e),console.log("JWT token present:",!!e.jwtToken),e.jwtToken&&console.log("JWT token length:",e.jwtToken.length),this.fetchEmployeeByAccountId()}fetchEmployeeByAccountId(){if(console.log("Fetching employee by account ID..."),!this.accountId){console.error("No account ID available"),this.alertService.error("Account information not available"),this.router.navigate(["/"]);return}let e=this.accountService.accountValue;if(!e||!e.jwtToken){console.error("No authentication token available"),this.alertService.error("Authentication required. Please log in again."),this.router.navigate(["/account/login"]);return}let o={headers:new q({Authorization:`Bearer ${e.jwtToken}`,"Content-Type":"application/json"}),withCredentials:!0};this.loading=!0,console.log("Making API call to get employees..."),this.http.get(`${w.apiUrl}/employees`,o).pipe(I()).subscribe({next:r=>{console.log("Employees data received, count:",r.length);let l=Number(this.accountId);console.log("Looking for employee with accountId:",l);let f=r.find(u=>Number(u.accountId)===l);f?(console.log("Found employee record:",f),this.employeeId=f.id,this.loadRequest()):(console.error("No employee record found for account ID:",l),this.alertService.error("No employee record found for your account"),this.loading=!1,this.router.navigate(["/requests"]))},error:r=>{console.error("Error fetching employee data:",r),this.alertService.error("Failed to load employee data: "+(r.message||"Unknown error")),this.loading=!1,this.router.navigate(["/requests"])}})}loadRequest(){if(console.log("Loading request with ID:",this.id),!this.id||!this.employeeId){console.error("Missing ID or employeeId",{id:this.id,employeeId:this.employeeId});return}this.loading=!0;let e=this.accountService.accountValue;if(!e||!e.jwtToken){console.error("No authentication token available"),this.alertService.error("Authentication required. Please log in again."),this.loading=!1,this.router.navigate(["/account/login"]);return}let o={headers:new q({Authorization:`Bearer ${e.jwtToken}`,"Content-Type":"application/json"}),withCredentials:!0};console.log("Making API call to get request...");let r=`${w.apiUrl}/requests/${this.id}`;console.log("Request URL:",r),this.http.get(r,o).pipe(I()).subscribe({next:l=>{if(console.log("Request data received:",l),l.employeeId!==this.employeeId){console.error("Request does not belong to current user",{requestEmployeeId:l.employeeId,userEmployeeId:this.employeeId}),this.alertService.error("You do not have permission to edit this request"),this.loading=!1,this.router.navigate(["/requests"]);return}if(l.status&&l.status.toLowerCase()!=="pending"){console.error("Request is not in pending status:",l.status),this.alertService.error(`This request cannot be edited because its status is ${l.status}`),this.loading=!1,this.router.navigate(["/requests"]);return}this.request=l,this.form.patchValue({title:l.title,description:l.description||"",priority:l.priority||"medium"}),["equipment","resources","leave"].includes(l.type)&&(this.resetItems(),l.details&&l.details.items&&Array.isArray(l.details.items)?l.details.items.forEach(f=>{this.items.push(this.createItemFormGroup(f.name,f.quantity))}):this.addItem()),this.loading=!1,console.log("Request loaded successfully")},error:l=>{console.error("Error loading request:",l),this.alertService.error("Error loading request: "+(l.message||"Unknown error")),this.loading=!1,this.router.navigate(["/requests"])}})}get f(){return this.form.controls}get items(){let e=this.form.get("details");return e?e.get("items"):(console.error("Details form group not found"),this.formBuilder.array([]))}createItemFormGroup(e="",o=1){return this.formBuilder.group({name:[e,C.required],quantity:[o,[C.required,C.min(1)]]})}addItem(){try{console.log("Adding item, current items length:",this.items.length),this.items.push(this.createItemFormGroup()),console.log("Item added, new items length:",this.items.length)}catch(e){console.error("Error adding item:",e),this.alertService.error("Error adding item to form")}}removeItem(e){try{this.items.removeAt(e)}catch(o){console.error("Error removing item:",o)}}resetItems(){try{for(;this.items.length;)this.items.removeAt(0)}catch(e){console.error("Error resetting items:",e)}}onSubmit(){if(console.log("Form submitted"),this.submitted=!0,this.alertService.clear(),console.log("Form state on submit:",this.form.value),console.log("Form valid?",this.form.valid),this.form.get("details.items")?.invalid&&console.error("Items are invalid:",this.form.get("details.items")),this.form.invalid){console.error("Form is invalid:",this.form.errors);return}this.loading=!0;let e={title:this.form.value.title,description:this.form.value.description,priority:this.form.value.priority};["equipment","resources","leave"].includes(this.request?.type||"")?e.items=this.form.value.details.items:e.details=this.form.value.details||{},console.log("Updating request with data:",e);let o=this.accountService.accountValue,r={headers:new q({Authorization:`Bearer ${o?.jwtToken}`,"Content-Type":"application/json"}),withCredentials:!0};this.http.put(`${w.apiUrl}/requests/${this.id}`,e,r).pipe(I()).subscribe({next:()=>{console.log("Request updated successfully"),this.alertService.success("Request updated successfully",{keepAfterRouteChange:!0}),this.router.navigate(["/requests"])},error:l=>{console.error("Update error:",l),this.alertService.error("Error updating request: "+(l.message||"Unknown error")),this.loading=!1}})}getStatusClass(e){switch(e.toLowerCase()){case"approved":return"status-success";case"rejected":return"status-danger";case"pending":return"status-warning";case"completed":return"status-success";case"cancelled":return"status-danger";default:return"status-info"}}static{this.\u0275fac=function(o){return new(o||t)(g(oe),g(he),g(se),g(N),g(L),g(P),g(O))}}static{this.\u0275cmp=T({type:t,selectors:[["ng-component"]],decls:5,vars:3,consts:[["class","text-center",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],["class","card",4,"ngIf"],[1,"text-center"],[1,"spinner-border","spinner-border-lg"],[1,"alert","alert-danger"],["routerLink","/requests",1,"btn","btn-primary"],[1,"card"],[1,"card-header"],[1,"d-flex","align-items-center"],[1,"mr-auto"],[1,"status-badge","ml-2",3,"ngClass"],[1,"card-body"],[1,"request-summary","mb-4"],[1,"row"],[1,"col-md-6"],[3,"ngSubmit","formGroup"],[1,"form-row"],[1,"form-group","col-md-6"],["type","text","formControlName","title",1,"form-control",3,"ngClass"],["class","invalid-feedback",4,"ngIf"],["formControlName","priority",1,"form-control"],["value","low"],["value","medium"],["value","high"],["value","urgent"],[1,"form-group"],["formControlName","description","rows","3",1,"form-control"],["class","mt-4","formGroupName","details",4,"ngIf"],[1,"form-group","mt-4"],["type","submit",1,"btn","btn-primary",3,"disabled"],["class","spinner-border spinner-border-sm mr-1",4,"ngIf"],["routerLink","/requests",1,"btn","btn-link"],[1,"invalid-feedback"],[4,"ngIf"],["formGroupName","details",1,"mt-4"],["formArrayName","items",1,"items-container"],["class","card mb-3",4,"ngFor","ngForOf"],["type","button",1,"btn","btn-outline-primary",3,"click"],[1,"card","mb-3"],[1,"card-body",3,"formGroupName"],[1,"d-flex","justify-content-between","align-items-center","mb-2"],[1,"mb-0"],["type","button","class","btn btn-sm btn-outline-danger",3,"click",4,"ngIf"],[1,"form-group","col-md-8"],["type","text","formControlName","name",1,"form-control",3,"ngClass","placeholder"],[1,"form-group","col-md-4"],["type","number","formControlName","quantity","min","1",1,"form-control",3,"ngClass"],["type","button",1,"btn","btn-sm","btn-outline-danger",3,"click"],[1,"spinner-border","spinner-border-sm","mr-1"]],template:function(o,r){o&1&&(n(0,"h1"),s(1,"Edit Request"),i(),p(2,et,2,0,"div",0)(3,tt,5,0,"div",1)(4,pt,53,19,"div",2)),o&2&&(a(2),d("ngIf",r.loading),a(),d("ngIf",!r.loading&&!r.request),a(),d("ngIf",!r.loading&&r.request))},dependencies:[A,R,M,J,ie,ne,z,W,te,Y,Q,re,K,ee,X,Z,F,U,H],styles:[`.status-badge[_ngcontent-%COMP%] {
        display: inline-block;
        padding: 0.4rem 0.6rem;
        border-radius: 0.25rem;
        color: white;
        text-align: center;
        min-width: 5rem;
    }
    .status-success[_ngcontent-%COMP%] {
        background-color: #28a745;
    }
    .status-warning[_ngcontent-%COMP%] {
        background-color: #ffc107;
        color: #212529;
    }
    .status-danger[_ngcontent-%COMP%] {
        background-color: #dc3545;
    }
    .status-info[_ngcontent-%COMP%] {
        background-color: #17a2b8;
    }
    .items-container[_ngcontent-%COMP%] {
        border: 1px solid #dee2e6;
        border-radius: 0.25rem;
        padding: 1rem;
        background-color: #f8f9fa;
    }`]})}}return t})();var ft=[{path:"",component:ye,children:[{path:"",component:Se},{path:"add",component:qe},{path:"edit/:id",component:we}]}],Te=(()=>{class t{static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275mod=$({type:t})}static{this.\u0275inj=B({imports:[ae.forChild(ft),ae]})}}return t})();var Jt=(()=>{class t{static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275mod=$({type:t})}static{this.\u0275inj=B({providers:[N],imports:[fe,ve,ge,Te]})}}return t})();export{Jt as RequestsModule};
