import{a as q}from"./chunk-7KBLVN73.js";import{a as T,b as L,e as D}from"./chunk-YOZUUFLZ.js";import{$ as O,A as n,Aa as le,B as i,C as f,Ca as me,Ea as ce,F as C,Fa as de,G as v,H as d,Ia as pe,Ja as ue,Ka as F,L as s,M as I,Ma as $,N as x,U as j,W as N,X as B,Y as U,a as H,aa as R,b as z,ba as P,ca as Y,da as Q,ea as J,fa as w,ga as k,j as b,ma as K,n as A,na as E,oa as W,p as S,pa as X,q as M,r as _,ra as Z,s as y,sa as ee,ta as te,u as a,ua as ie,v as u,va as ne,w as p,wa as oe,x as l,xa as re,ya as se,za as ae}from"./chunk-ZYNGRVCC.js";var ge=(()=>{class t{static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275cmp=S({type:t,selectors:[["ng-component"]],decls:2,vars:0,consts:[[1,"content"]],template:function(r,o){r&1&&(n(0,"div",0),f(1,"router-outlet"),i())},dependencies:[pe],styles:[".content[_ngcontent-%COMP%]{padding:1rem}"]})}}return t})();function Ie(t,m){t&1&&(n(0,"div",6),f(1,"div",7),n(2,"p"),s(3,"Loading requests..."),i()())}function Ee(t,m){if(t&1){let e=C();n(0,"div",8)(1,"p"),s(2,"Error loading requests. This could be due to an authentication issue or server problem."),i(),n(3,"button",9),v("click",function(){_(e);let o=d();return y(o.retryLoading())}),s(4,"Retry Loading"),i()()}}function qe(t,m){t&1&&(n(0,"div",10)(1,"p"),s(2,"No employee record is associated with your account. Please contact an administrator to set up your employee profile."),i()())}function we(t,m){t&1&&(n(0,"div",10)(1,"p"),s(2,"You don't have any requests yet."),i()())}function Te(t,m){if(t&1&&(n(0,"div")(1,"strong"),s(2,"Items:"),i(),s(3),i()),t&2){let e=d().$implicit,r=d(2);a(3),x(" ",r.getItemsDescription(e)," ")}}function Ae(t,m){if(t&1&&(n(0,"div")(1,"strong"),s(2,"Days:"),i(),s(3),i()),t&2){let e=d().$implicit,r=d(2);a(3),x(" ",r.getItemsDescription(e)," ")}}function Me(t,m){if(t&1&&(n(0,"div"),s(1),i()),t&2){let e=d().$implicit;a(),x(" ",e.description||"No description provided"," ")}}function Ne(t,m){if(t&1&&(n(0,"tr")(1,"td"),s(2),N(3,"titlecase"),i(),n(4,"td"),s(5),i(),n(6,"td"),s(7),N(8,"date"),i(),n(9,"td")(10,"span",15),s(11),N(12,"titlecase"),i()(),n(13,"td"),p(14,Te,4,1,"div",14)(15,Ae,4,1,"div",14)(16,Me,2,1,"div",14),i()()),t&2){let e=m.$implicit,r=d(2);a(2),I(B(3,8,e.type)),a(3),I(e.title),a(2),I(U(8,10,e.created,"M/d/yyyy")),a(3),l("ngClass",r.getStatusClass(e.status)),a(),x(" ",B(12,13,e.status)," "),a(3),l("ngIf",e.type==="equipment"||e.type==="resources"),a(),l("ngIf",e.type==="leave"),a(),l("ngIf",e.type!=="equipment"&&e.type!=="resources"&&e.type!=="leave")}}function Oe(t,m){t&1&&(n(0,"tr")(1,"td",16)(2,"span"),s(3,"No requests found"),i()()())}function Re(t,m){if(t&1&&(n(0,"div",11)(1,"table",12)(2,"thead")(3,"tr")(4,"th"),s(5,"Type"),i(),n(6,"th"),s(7,"Title"),i(),n(8,"th"),s(9,"Date"),i(),n(10,"th"),s(11,"Status"),i(),n(12,"th"),s(13,"Details"),i()()(),n(14,"tbody"),p(15,Ne,17,15,"tr",13)(16,Oe,4,0,"tr",14),i()()()),t&2){let e=d();a(15),l("ngForOf",e.requests),a(),l("ngIf",e.requests.length===0)}}var ve=(()=>{class t{constructor(e,r,o,c){this.requestService=e,this.accountService=r,this.alertService=o,this.http=c,this.requests=[],this.loading=!1,this.hasEmployeeRecord=!0,this.loadError=!1,console.log("Request list component constructed")}ngOnInit(){console.log("Request list component initialized"),this.loading=!0;let e=this.accountService.accountValue;if(!e){this.alertService.error("You must be logged in to view requests"),this.loading=!1,this.loadError=!0;return}this.accountId=e.id,console.log("AccountID found:",this.accountId),this.fetchEmployeeByAccountId()}fetchEmployeeByAccountId(){if(console.log("Fetching employee record"),!this.accountId){console.error("No account ID available"),this.loading=!1,this.loadError=!0;return}let e=this.accountService.accountValue;if(!e||!e.jwtToken){console.error("No authentication token available"),this.alertService.error("Authentication required. Please log in again."),this.loading=!1,this.loadError=!0;return}let r={headers:new w({Authorization:`Bearer ${e.jwtToken}`,"Content-Type":"application/json"}),withCredentials:!0};this.http.get(`${T.apiUrl}/employees`,r).pipe(b()).subscribe({next:o=>{console.log("Employees data received:",o);let c=Number(this.accountId),g=o.find(h=>Number(h.accountId)===c);g?(console.log("Found employee record:",g),this.employeeId=g.id,this.hasEmployeeRecord=!0,this.loadRequests()):(console.log("No employee record found"),this.hasEmployeeRecord=!1,this.loading=!1)},error:o=>{console.error("Error fetching employee data:",o),o.status===401?this.alertService.error("Authentication failed. Please log in again."):this.alertService.error("Failed to load employee data: "+(o.message||"Unknown error")),this.hasEmployeeRecord=!1,this.loading=!1,this.loadError=!0}})}loadRequests(){if(console.log("Loading requests for employeeId:",this.employeeId),!this.employeeId){console.error("No employee ID available"),this.loading=!1,this.loadError=!0;return}let e=`${T.apiUrl}/requests?employeeId=${this.employeeId}`,r=this.accountService.accountValue;if(!r||!r.jwtToken){console.error("No authentication token available"),this.alertService.error("Authentication required. Please log in again."),this.loading=!1,this.loadError=!0;return}let o={headers:new w({Authorization:`Bearer ${r.jwtToken}`,"Content-Type":"application/json"}),withCredentials:!0};this.http.get(e,o).pipe(b()).subscribe({next:c=>{console.log("My requests received:",c),this.requests=c.map(g=>z(H({},g),{created:new Date(g.created)})),this.loading=!1},error:c=>{console.error("Error loading requests:",c),c.status===401?this.alertService.error("Authentication failed. Please log in again."):this.alertService.error("Failed to load requests: "+(c.message||"Unknown error")),this.loading=!1,this.loadError=!0}})}retryLoading(){console.log("Retrying data load"),this.loading=!0,this.loadError=!1,this.employeeId?this.loadRequests():this.fetchEmployeeByAccountId()}getStatusClass(e){switch(e.toLowerCase()){case"approved":return"status-success";case"rejected":return"status-danger";case"pending":return"status-warning";case"completed":return"status-success";case"cancelled":return"status-danger";default:return"status-info"}}getItemsDescription(e){return!e.details||!e.details.items||!e.details.items.length?"No items specified":e.details.items.map(r=>`${r.name} (${r.quantity})`).join(", ")}static{this.\u0275fac=function(r){return new(r||t)(u(q),u(L),u(D),u(k))}}static{this.\u0275cmp=S({type:t,selectors:[["ng-component"]],decls:10,vars:5,consts:[["class","text-center mb-3",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],["class","alert alert-info",4,"ngIf"],["class","table-responsive",4,"ngIf"],[1,"mt-3"],["routerLink","/requests/add",1,"btn","btn-success"],[1,"text-center","mb-3"],[1,"spinner-border","spinner-border-lg","align-center"],[1,"alert","alert-danger"],[1,"btn","btn-outline-primary","mt-2",3,"click"],[1,"alert","alert-info"],[1,"table-responsive"],[1,"table","table-bordered"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"status-badge",3,"ngClass"],["colspan","5",1,"text-center"]],template:function(r,o){r&1&&(n(0,"h1"),s(1,"My Requests"),i(),p(2,Ie,4,0,"div",0)(3,Ee,5,0,"div",1)(4,qe,3,0,"div",2)(5,we,3,0,"div",2)(6,Re,17,2,"div",3),n(7,"div",4)(8,"a",5),s(9,"Create New Request"),i()()),r&2&&(a(2),l("ngIf",o.loading),a(),l("ngIf",o.loadError),a(),l("ngIf",!o.loading&&!o.loadError&&!o.hasEmployeeRecord),a(),l("ngIf",!o.loading&&!o.loadError&&o.hasEmployeeRecord&&o.requests.length===0),a(),l("ngIf",!o.loading&&!o.loadError&&o.hasEmployeeRecord))},dependencies:[O,R,P,F,Y,Q],styles:[`.table[_ngcontent-%COMP%] {
        margin-bottom: 0;
    }
    .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%] {
        background-color: #f8f9fa;
        font-weight: bold;
    }
    .table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%] {
        padding: 0.75rem;
        vertical-align: middle;
        border: 1px solid #dee2e6;
    }
    .status-badge[_ngcontent-%COMP%] {
        display: inline-block;
        padding: 0.4rem 0.6rem;
        border-radius: 0.25rem;
        color: white;
        text-align: center;
        min-width: 5rem;
    }
    .status-success[_ngcontent-%COMP%] {
        background-color: #28a745;
    }
    .status-warning[_ngcontent-%COMP%] {
        background-color: #ffc107;
        color: #212529;
    }
    .status-danger[_ngcontent-%COMP%] {
        background-color: #dc3545;
    }
    .status-info[_ngcontent-%COMP%] {
        background-color: #17a2b8;
    }
    .mt-2[_ngcontent-%COMP%] {
        margin-top: 0.5rem;
    }
    .mt-3[_ngcontent-%COMP%] {
        margin-top: 1rem;
    }
    .mb-3[_ngcontent-%COMP%] {
        margin-bottom: 1rem;
    }
    .btn-success[_ngcontent-%COMP%] {
        background-color: #28a745;
        color: white;
        border: none;
    }
    .table-responsive[_ngcontent-%COMP%] {
        overflow-x: auto;
    }`]})}}return t})();var he=t=>({"is-invalid":t});function Pe(t,m){if(t&1&&(n(0,"option",18),s(1),i()),t&2){let e=m.$implicit;l("value",e.value),a(),I(e.label)}}function ke(t,m){t&1&&(n(0,"div"),s(1,"Request type is required"),i())}function Fe(t,m){if(t&1&&(n(0,"div",19),p(1,ke,2,0,"div",20),i()),t&2){let e=d();a(),l("ngIf",e.f.type.errors.required)}}function Le(t,m){t&1&&(n(0,"div"),s(1,"Title is required"),i())}function De(t,m){if(t&1&&(n(0,"div",19),p(1,Le,2,0,"div",20),i()),t&2){let e=d();a(),l("ngIf",e.f.title.errors.required)}}function Ve(t,m){if(t&1){let e=C();n(0,"div",26)(1,"div",27)(2,"label"),s(3,"Leave Type"),i(),n(4,"select",28)(5,"option",29),s(6,"Vacation"),i(),n(7,"option",30),s(8,"Sick"),i(),n(9,"option",31),s(10,"Personal"),i(),n(11,"option",32),s(12,"Bereavement"),i(),n(13,"option",33),s(14,"Other"),i()()(),n(15,"div",34)(16,"label"),s(17,"Number of Days"),i(),f(18,"input",35),i(),n(19,"div",36)(20,"button",37),v("click",function(){let o=_(e).index,c=d(2);return y(c.removeItem(o))}),s(21,"Remove"),i()()()}if(t&2){let e=m.index;l("formGroupName",e)}}function je(t,m){if(t&1){let e=C();n(0,"div",21)(1,"h4"),s(2,"Leave Details"),i(),n(3,"div",22)(4,"div",23),p(5,Ve,22,1,"div",24),i()(),n(6,"button",25),v("click",function(){_(e);let o=d();return y(o.addItem())}),s(7,"Add More Leave"),i()()}if(t&2){let e=d();a(5),l("ngForOf",e.items.controls)}}function Be(t,m){if(t&1){let e=C();n(0,"div",26)(1,"div",27)(2,"label"),s(3,"Item Name"),i(),f(4,"input",39),i(),n(5,"div",34)(6,"label"),s(7,"Quantity"),i(),f(8,"input",35),i(),n(9,"div",36)(10,"button",37),v("click",function(){let o=_(e).index,c=d(2);return y(c.removeItem(o))}),s(11,"Remove"),i()()()}if(t&2){let e=m.index;l("formGroupName",e)}}function $e(t,m){if(t&1){let e=C();n(0,"div",38)(1,"h4"),s(2),i(),n(3,"div",22)(4,"div",23),p(5,Be,12,1,"div",24),i()(),n(6,"button",25),v("click",function(){_(e);let o=d();return y(o.addItem())}),s(7,"Add Another Item"),i()()}if(t&2){let e=d();a(2),x("",e.currentType==="equipment"?"Equipment":"Resources"," Details"),a(3),l("ngForOf",e.items.controls)}}function Ge(t,m){t&1&&(n(0,"div",3)(1,"label",40),s(2,"Description"),i(),f(3,"textarea",41),i())}function He(t,m){t&1&&f(0,"span",42)}var _e=(()=>{class t{constructor(e,r,o,c,g,h){this.formBuilder=e,this.router=r,this.requestService=o,this.accountService=c,this.alertService=g,this.http=h,this.loading=!1,this.submitted=!1,this.loadError=!1,this.requestTypes=[{value:"leave",label:"Leave Request"},{value:"equipment",label:"Equipment Request"},{value:"resources",label:"Resources Request"},{value:"other",label:"Other Request"}],this.currentType=""}ngOnInit(){console.log("Add request component initialized"),this.form=this.formBuilder.group({type:["",E.required],title:["",E.required],description:[""],details:this.formBuilder.group({items:this.formBuilder.array([])})}),console.log("Initial form structure:",this.form),console.log("Items FormArray exists:",this.form.get("details.items")!==null),this.form.get("type")?.valueChanges.subscribe(r=>{this.currentType=r,this.resetItems(),(r==="leave"||r==="equipment"||r==="resources")&&this.addItem()});let e=this.accountService.accountValue?.id;e?(console.log("AccountID found:",e),this.fetchEmployeeByAccountId(e)):(this.loadError=!0,this.alertService.error("Account information not available"))}fetchEmployeeByAccountId(e){let r=this.accountService.accountValue,o={headers:new w({"Content-Type":"application/json",Authorization:`Bearer ${r?.jwtToken}`}),withCredentials:!0};this.http.get(`${T.apiUrl}/employees`,o).pipe(b()).subscribe({next:c=>{console.log("All employees:",c);let g=parseInt(e||"0"),h=c.find(G=>G.accountId===g||String(G.accountId)===e);h?(console.log("Found employee record:",h),this.employeeId=h.id):(console.log("No employee record found for account ID:",e),this.alertService.warn("Your account is not linked to an employee record. Please contact an administrator."))},error:c=>{console.error("Error fetching employees:",c),this.alertService.warn("Authentication error. Please try logging out and back in.")}})}get f(){return this.form.controls}get items(){let e=this.form.get("details");return e?e.get("items"):(console.error("Details form group not found"),this.formBuilder.array([]))}addItem(){try{console.log("Adding item, current items length:",this.items.length),this.items.push(this.formBuilder.group({name:["",E.required],quantity:[1,[E.required,E.min(1)]]})),console.log("Item added, new items length:",this.items.length)}catch(e){console.error("Error adding item:",e),this.alertService.error("Error adding item to form")}}removeItem(e){try{this.items.removeAt(e)}catch(r){console.error("Error removing item:",r)}}resetItems(){try{for(;this.items.length;)this.items.removeAt(0)}catch(e){console.error("Error resetting items:",e)}}onSubmit(){if(this.submitted=!0,this.alertService.clear(),console.log("Form state on submit:",this.form.value),console.log("Form valid?",this.form.valid),this.form.get("details.items")?.invalid&&console.error("Items are invalid:",this.form.get("details.items")),this.form.invalid)return;if(!this.employeeId){this.alertService.error("Cannot submit request: No employee ID available");return}this.loading=!0;let e={employeeId:this.employeeId,type:this.form.value.type,title:this.form.value.title,status:"pending"};if(this.form.value.type==="other"){if(!this.form.value.description){this.alertService.error("Description is required for this request type"),this.loading=!1;return}e.description=this.form.value.description}else e.description=this.form.value.description||"New request";if(["equipment","resources","leave"].includes(this.form.value.type)){if(e.items=this.form.value.details?.items||[],!e.items||e.items.length===0){this.alertService.error(`Please add at least one item to your ${this.form.value.type} request`),this.loading=!1;return}}else e.details=this.form.value.details||{};console.log("Submitting request with data:",e),this.requestService.create(e).pipe(b()).subscribe({next:()=>{this.alertService.success("Request created successfully",{keepAfterRouteChange:!0}),this.router.navigate(["/requests"])},error:r=>{console.error("Error creating request:",r),this.alertService.error(r),this.loading=!1}})}static{this.\u0275fac=function(r){return new(r||t)(u(me),u(ue),u(q),u(L),u(D),u(k))}}static{this.\u0275cmp=S({type:t,selectors:[["ng-component"]],decls:27,vars:15,consts:[[1,"card"],[1,"card-body"],[3,"ngSubmit","formGroup"],[1,"form-group"],["for","type"],["id","type","formControlName","type",1,"form-control",3,"ngClass"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","invalid-feedback",4,"ngIf"],["for","title"],["type","text","id","title","formControlName","title",1,"form-control",3,"ngClass"],["class","leave-section",4,"ngIf"],["class","item-section",4,"ngIf"],["class","form-group",4,"ngIf"],[1,"form-group","mt-4"],["type","submit",1,"btn","btn-primary",3,"disabled"],["class","spinner-border spinner-border-sm mr-1",4,"ngIf"],["routerLink","/requests",1,"btn","btn-link"],[3,"value"],[1,"invalid-feedback"],[4,"ngIf"],[1,"leave-section"],["formGroupName","details"],["formArrayName","items"],["class","form-row mb-2",3,"formGroupName",4,"ngFor","ngForOf"],["type","button",1,"btn","btn-info","btn-sm","mt-2",3,"click"],[1,"form-row","mb-2",3,"formGroupName"],[1,"col-md-6"],["formControlName","name",1,"form-control"],["value","Vacation"],["value","Sick"],["value","Personal"],["value","Bereavement"],["value","Other"],[1,"col-md-4"],["type","number","formControlName","quantity","min","1",1,"form-control"],[1,"col-md-2","d-flex","align-items-end"],["type","button",1,"btn","btn-danger","btn-sm",3,"click"],[1,"item-section"],["type","text","formControlName","name",1,"form-control"],["for","description"],["id","description","formControlName","description","rows","4",1,"form-control"],[1,"spinner-border","spinner-border-sm","mr-1"]],template:function(r,o){r&1&&(n(0,"h1"),s(1,"Create New Request"),i(),n(2,"div",0)(3,"div",1)(4,"form",2),v("ngSubmit",function(){return o.onSubmit()}),n(5,"div",3)(6,"label",4),s(7,"Request Type"),i(),n(8,"select",5)(9,"option",6),s(10,"-- Select Type --"),i(),p(11,Pe,2,2,"option",7),i(),p(12,Fe,2,1,"div",8),i(),n(13,"div",3)(14,"label",9),s(15,"Title"),i(),f(16,"input",10),p(17,De,2,1,"div",8),i(),p(18,je,8,1,"div",11)(19,$e,8,2,"div",12)(20,Ge,4,0,"div",13),n(21,"div",14)(22,"button",15),p(23,He,1,0,"span",16),s(24," Submit Request "),i(),n(25,"a",17),s(26,"Cancel"),i()()()()()),r&2&&(a(4),l("formGroup",o.form),a(4),l("ngClass",j(11,he,o.submitted&&o.f.type.errors)),a(3),l("ngForOf",o.requestTypes),a(),l("ngIf",o.submitted&&o.f.type.errors),a(4),l("ngClass",j(13,he,o.submitted&&o.f.title.errors)),a(),l("ngIf",o.submitted&&o.f.title.errors),a(),l("ngIf",o.currentType==="leave"),a(),l("ngIf",o.currentType==="equipment"||o.currentType==="resources"),a(),l("ngIf",o.currentType==="other"),a(2),l("disabled",o.loading),a(),l("ngIf",o.loading))},dependencies:[O,R,P,Z,se,ae,K,ee,re,W,X,le,te,oe,ie,ne,F],styles:[`.form-row[_ngcontent-%COMP%] {
        display: flex;
        margin-right: -5px;
        margin-left: -5px;
    }
    .col-md-6[_ngcontent-%COMP%], .col-md-4[_ngcontent-%COMP%], .col-md-2[_ngcontent-%COMP%] {
        padding-right: 5px;
        padding-left: 5px;
    }
    .col-md-6[_ngcontent-%COMP%] {
        flex: 0 0 50%;
        max-width: 50%;
    }
    .col-md-4[_ngcontent-%COMP%] {
        flex: 0 0 33.333333%;
        max-width: 33.333333%;
    }
    .col-md-2[_ngcontent-%COMP%] {
        flex: 0 0 16.666667%;
        max-width: 16.666667%;
    }
    .d-flex[_ngcontent-%COMP%] {
        display: flex;
    }
    .align-items-end[_ngcontent-%COMP%] {
        align-items: flex-end;
    }
    .mb-2[_ngcontent-%COMP%] {
        margin-bottom: 0.5rem;
    }
    .mt-2[_ngcontent-%COMP%] {
        margin-top: 0.5rem;
    }
    .mt-4[_ngcontent-%COMP%] {
        margin-top: 1.5rem;
    }`]})}}return t})();var ze=[{path:"",component:ge,children:[{path:"",component:ve},{path:"add",component:_e}]}],ye=(()=>{class t{static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275mod=M({type:t})}static{this.\u0275inj=A({imports:[$.forChild(ze),$]})}}return t})();var yt=(()=>{class t{static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275mod=M({type:t})}static{this.\u0275inj=A({providers:[q],imports:[J,de,ce,ye]})}}return t})();export{yt as RequestsModule};
