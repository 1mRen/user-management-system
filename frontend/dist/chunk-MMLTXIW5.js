import{Fa as w,a as s,b as u,c as m,ca as j,d,f as c,g as b,i as p,l as h,n as f}from"./chunk-U6ZOIJ5K.js";var l={production:!1,apiUrl:"http://localhost:4000"};var i=`${l.apiUrl}/accounts`,V=(()=>{class e{constructor(t,r){this.router=t,this.http=r,this.accountSubject=new d(null),this.account=this.accountSubject.asObservable()}get accountValue(){return this.accountSubject.value}login(t,r){return this.http.post(`${i}/login`,{email:t,password:r},{withCredentials:!0}).pipe(c(o=>(this.accountSubject.next(o),this.startRefreshTokenTimer(),o)))}logout(){this.http.post(`${i}/logout`,{},{withCredentials:!0}).pipe(p(()=>{this.stopRefreshTokenTimer(),this.accountSubject.next(null),this.router.navigate(["/account/login"])})).subscribe({error:t=>{console.error("Logout error:",t)}})}refreshToken(){return this.http.post(`${i}/refresh-token`,{},{withCredentials:!0}).pipe(c(t=>(this.accountSubject.next(t),this.startRefreshTokenTimer(),t)))}register(t){return this.http.post(`${i}/register`,t)}verifyEmail(t){return this.http.post(`${i}/verify-email`,{token:t})}forgotPassword(t){return this.http.post(`${i}/forgot-password`,{email:t})}validateResetToken(t){return this.http.post(`${i}/validate-reset-token`,{token:t})}resetPassword(t,r,o){return this.http.post(`${i}/reset-password`,{token:t,password:r,confirmPassword:o})}getAll(){return this.http.get(i)}getById(t){return this.http.get(`${i}/${t}`)}create(t){return this.http.post(i,t)}update(t,r){return this.http.put(`${i}/${t}`,r).pipe(c(o=>(o.id===this.accountValue.id&&(o=s(s({},this.accountValue),o),this.accountSubject.next(o)),o)))}delete(t){return this.http.delete(`${i}/${t}`).pipe(p(()=>{t===this.accountValue.id&&this.logout()}))}resendVerificationEmail(t){return this.http.post(`${i}/resend-verification-email`,{email:t})}updateStatus(t,r){return this.http.patch(`${l.apiUrl}/accounts/${t}/status`,{isActive:r})}startRefreshTokenTimer(){if(!this.accountValue?.jwtToken)return;let r=JSON.parse(atob(this.accountValue.jwtToken.split(".")[1])).exp*1e3-Date.now()-60*1e3;this.refreshTokenTimeout=setTimeout(()=>this.refreshToken().subscribe(),r)}stopRefreshTokenTimer(){clearTimeout(this.refreshTokenTimeout)}static{this.\u0275fac=function(r){return new(r||e)(f(w),f(j))}}static{this.\u0275prov=h({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var n=class{constructor(g){Object.assign(this,g)}},a=function(e){return e[e.Success=0]="Success",e[e.Error=1]="Error",e[e.Info=2]="Info",e[e.Warning=3]="Warning",e}(a||{});var k=function(e){return e.User="User",e.Admin="Admin",e}(k||{});var J=(()=>{class e{constructor(){this.subject=new m,this.defaultId="default-alert"}onAlert(t=this.defaultId){return this.subject.asObservable().pipe(b(r=>r&&r.id===t))}success(t,r){this.alert(new n(u(s({},r),{type:a.Success,message:t})))}error(t,r){this.alert(new n(u(s({},r),{type:a.Error,message:t})))}info(t,r){this.alert(new n(u(s({},r),{type:a.Info,message:t})))}warn(t,r){this.alert(new n(u(s({},r),{type:a.Warning,message:t})))}alert(t){t.id=t.id||this.defaultId,t.autoClose=t.autoClose===void 0?!0:t.autoClose,this.subject.next(t)}clear(t=this.defaultId){this.subject.next(new n({id:t}))}static{this.\u0275fac=function(r){return new(r||e)}}static{this.\u0275prov=h({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();export{l as a,V as b,a as c,k as d,J as e};
