import{e as ae}from"./chunk-63GHBJUO.js";import{b as I,e as oe}from"./chunk-UYVSYKOO.js";import{$ as G,A as n,B as i,C as c,D as V,Da as te,E as j,F as T,Fa as ie,G as M,H as p,Ha as ne,J as D,Ja as re,K as O,Ka as y,L as o,M as F,Ma as q,N as h,P as U,U as g,Z as B,aa as $,ba as x,ea as z,j as f,ma as H,n as S,na as u,oa as J,p as b,pa as K,q as A,r as w,ra as Q,s as N,ta as W,u as a,v,w as m,wa as X,x as d,xa as Y,y as R,ya as Z,z as C,za as ee}from"./chunk-ZYNGRVCC.js";function pe(e,s){if(e&1&&(n(0,"tr")(1,"td"),o(2),i(),n(3,"td"),o(4),i(),n(5,"td"),o(6),i(),n(7,"td")(8,"span"),o(9),i()(),n(10,"td",7)(11,"a",8),o(12,"Edit"),i()()()),e&2){let t=s.$implicit;a(2),U(" ",t.title," ",t.firstName," ",t.lastName," "),a(2),F(t.email),a(2),F(t.role),a(2),C(t.isActive?"badge bg-success":"badge bg-danger"),a(),h(" ",t.isActive?"Active":"Inactive"," "),a(2),D("routerLink","edit/",t.id,"")}}function ue(e,s){e&1&&(n(0,"tr")(1,"td",9),c(2,"span",10),i()())}var de=(()=>{class e{constructor(t){this.accountService=t,this.currentUserId=this.accountService.accountValue?.id}ngOnInit(){this.loadAccounts()}loadAccounts(){this.accountService.getAll().pipe(f()).subscribe(t=>this.accounts=t)}deleteAccount(t){let l=this.accounts.find(r=>r.id===t);l.isDeleting=!0,this.accountService.delete(t).pipe(f()).subscribe(()=>this.accounts=this.accounts.filter(r=>r.id!==t))}toggleAccountStatus(t){t.isToggling=!0;let l=!t.isActive;this.accountService.updateStatus(t.id,l).pipe(f()).subscribe({next:()=>{t.isActive=l,t.isToggling=!1},error:r=>{console.error("Error updating account status:",r),t.isToggling=!1}})}isAdmin(t){return t.role==="Admin"}static{this.\u0275fac=function(l){return new(l||e)(v(I))}}static{this.\u0275cmp=b({type:e,selectors:[["ng-component"]],decls:22,vars:2,consts:[["routerLink","add",1,"btn","btn-sm","btn-success","mb-2"],[1,"table","table-striped"],[2,"width","25%"],[2,"width","20%"],[2,"width","15%"],[4,"ngFor","ngForOf"],[4,"ngIf"],[2,"white-space","nowrap"],[1,"btn","btn-sm","btn-primary","mr-1",3,"routerLink"],["colspan","5",1,"text-center"],[1,"spinner-border","spinner-border-lg","align-center"]],template:function(l,r){l&1&&(n(0,"h1"),o(1,"Accounts"),i(),n(2,"p"),o(3,"All accounts from secure (admin only) api end point:"),i(),n(4,"a",0),o(5,"Create Account"),i(),n(6,"table",1)(7,"thead")(8,"tr")(9,"th",2),o(10,"Name"),i(),n(11,"th",2),o(12,"Email"),i(),n(13,"th",3),o(14,"Role"),i(),n(15,"th",4),o(16,"Status"),i(),n(17,"th",4),o(18,"Actions"),i()()(),n(19,"tbody"),m(20,pe,13,10,"tr",5)(21,ue,3,0,"tr",6),i()()),l&2&&(a(20),d("ngForOf",r.accounts),a(),d("ngIf",!r.accounts))},dependencies:[$,x,y],encapsulation:2})}}return e})();var _=e=>({"is-invalid":e});function fe(e,s){e&1&&(V(0),o(1,"Create Account"),j())}function ve(e,s){e&1&&o(0,"Edit Account")}function ge(e,s){e&1&&(n(0,"div"),o(1,"Title is required"),i())}function _e(e,s){if(e&1&&(n(0,"div",28),m(1,ge,2,0,"div",21),i()),e&2){let t=p();a(),d("ngIf",t.f.title.errors.required)}}function he(e,s){e&1&&(n(0,"div"),o(1,"First Name is required"),i())}function Ee(e,s){if(e&1&&(n(0,"div",28),m(1,he,2,0,"div",21),i()),e&2){let t=p();a(),d("ngIf",t.f.firstName.errors.required)}}function Se(e,s){e&1&&(n(0,"div"),o(1,"Last Name is required"),i())}function be(e,s){if(e&1&&(n(0,"div",28),m(1,Se,2,0,"div",21),i()),e&2){let t=p();a(),d("ngIf",t.f.lastName.errors.required)}}function Ae(e,s){e&1&&(n(0,"div"),o(1,"Email is required"),i())}function Ce(e,s){e&1&&(n(0,"div"),o(1,"Email must be a valid email address"),i())}function xe(e,s){if(e&1&&(n(0,"div",28),m(1,Ae,2,0,"div",21)(2,Ce,2,0,"div",21),i()),e&2){let t=p();a(),d("ngIf",t.f.email.errors.required),a(),d("ngIf",t.f.email.errors.email)}}function ye(e,s){e&1&&(n(0,"div"),o(1,"Role is required"),i())}function Ie(e,s){if(e&1&&(n(0,"div",28),m(1,ye,2,0,"div",21),i()),e&2){let t=p();a(),d("ngIf",t.f.role.errors.required)}}function we(e,s){e&1&&c(0,"span",40)}function Ne(e,s){if(e&1){let t=T();n(0,"div",29)(1,"div",30)(2,"div",31)(3,"div",32),o(4," Account Status "),i(),n(5,"div",33)(6,"div",34)(7,"div")(8,"span",35),o(9,"Status:"),i(),n(10,"span",36),o(11),i()(),n(12,"button",37),M("click",function(){w(t);let r=p();return N(r.toggleStatus())}),o(13),m(14,we,1,0,"span",38),i()(),n(15,"small",39),o(16),i()()()()()}if(e&2){let t=p();a(10),C(t.account.isActive?"badge bg-success":"badge bg-danger"),a(),h(" ",t.account.isActive?"Active":"Inactive"," "),a(),R("btn-danger",t.account.isActive)("btn-success",!t.account.isActive),d("disabled",t.loading),a(),h(" ",t.account.isActive?"Deactivate Account":"Activate Account"," "),a(),d("ngIf",t.loading),a(2),h(" ",t.account.isActive?"Deactivating this account will prevent the user from logging in.":"Activating this account will allow the user to log in again."," ")}}function Te(e,s){e&1&&(n(0,"div")(1,"h3",41),o(2,"Change Password"),i(),n(3,"p"),o(4,"Leave blank to keep the same password"),i()())}function Me(e,s){e&1&&(n(0,"div"),o(1,"Password is required"),i())}function Fe(e,s){e&1&&(n(0,"div"),o(1," Password must be at least 6 characters "),i())}function qe(e,s){if(e&1&&(n(0,"div",28),m(1,Me,2,0,"div",21)(2,Fe,2,0,"div",21),i()),e&2){let t=p();a(),d("ngIf",t.f.password.errors.required),a(),d("ngIf",t.f.password.errors.minlength)}}function ke(e,s){e&1&&(n(0,"div"),o(1,"Confirm Password is required"),i())}function Le(e,s){e&1&&(n(0,"div"),o(1,"Passwords must match"),i())}function Pe(e,s){if(e&1&&(n(0,"div",28),m(1,ke,2,0,"div",21)(2,Le,2,0,"div",21),i()),e&2){let t=p();a(),d("ngIf",t.f.confirmPassword.errors.required),a(),d("ngIf",t.f.confirmPassword.errors.mustMatch)}}function Re(e,s){e&1&&c(0,"span",42)}var L=(()=>{class e{constructor(t,l,r,E,P){this.formBuilder=t,this.route=l,this.router=r,this.accountService=E,this.alertService=P,this.loading=!1,this.submitted=!1,this.isAdmin=!1}ngOnInit(){this.id=this.route.snapshot.params.id,this.isAddMode=!this.id,this.form=this.formBuilder.group({title:["",u.required],firstName:["",u.required],lastName:["",u.required],email:["",[u.required,u.email]],role:["",u.required],isActive:[!0],password:["",[u.minLength(6),this.isAddMode?u.required:u.nullValidator]],confirmPassword:[""]},{validator:ae("password","confirmPassword")}),this.isAddMode||this.accountService.getById(this.id).pipe(f()).subscribe(t=>{this.account=t,this.isAdmin=t.role==="Admin",this.form.patchValue(t)})}get f(){return this.form.controls}onSubmit(){this.submitted=!0,this.alertService.clear(),!this.form.invalid&&(this.loading=!0,this.isAddMode?this.createAccount():this.updateAccount())}toggleStatus(){if(!this.account||this.isAdmin)return;let t=!this.account.isActive;this.loading=!0,this.accountService.updateStatus(this.id,t).pipe(f()).subscribe({next:()=>{this.account.isActive=t,this.form.patchValue({isActive:t}),this.alertService.success(`Account ${t?"activated":"deactivated"} successfully`,{keepAfterRouteChange:!0}),this.loading=!1},error:l=>{this.alertService.error(`Failed to ${t?"activate":"deactivate"} account`),this.loading=!1}})}createAccount(){this.accountService.create(this.form.value).pipe(f()).subscribe({next:()=>{this.alertService.success("Account created successfully",{keepAfterRouteChange:!0}),this.router.navigate(["../"],{relativeTo:this.route})},error:t=>{this.alertService.error(t),this.loading=!1}})}updateAccount(){this.accountService.update(this.id,this.form.value).pipe(f()).subscribe({next:()=>{this.alertService.success("Update successful",{keepAfterRouteChange:!0}),this.router.navigate(["../"],{relativeTo:this.route})},error:t=>{this.alertService.error(t),this.loading=!1}})}static{this.\u0275fac=function(l){return new(l||e)(v(te),v(ne),v(re),v(I),v(oe))}}static{this.\u0275cmp=b({type:e,selectors:[["ng-component"]],decls:66,vars:35,consts:[["editTitle",""],[4,"ngIf","ngIfElse"],[3,"ngSubmit","formGroup"],[1,"form-row"],[1,"form-group","col"],["formControlName","title",1,"form-control",3,"ngClass"],["value",""],["value","Mr."],["value","Mrs."],["value","Miss"],["value","Ms."],["class","invalid-feedback",4,"ngIf"],[1,"form-group","col-5"],["type","text","formControlName","firstName",1,"form-control",3,"ngClass"],["type","text","formControlName","lastName",1,"form-control",3,"ngClass"],[1,"form-group","col-7"],["type","text","formControlName","email",1,"form-control",3,"ngClass"],["formControlName","role",1,"form-control",3,"ngClass"],["value","User"],["value","Admin"],["class","form-row mb-3 mt-3",4,"ngIf"],[4,"ngIf"],["type","password","formControlName","password",1,"form-control",3,"ngClass"],["type","password","formControlName","confirmPassword",1,"form-control",3,"ngClass"],[1,"form-group"],[1,"btn","btn-primary",3,"disabled"],["class","spinner-border spinner-border-sm mr-1",4,"ngIf"],["routerLink","/admin/accounts",1,"btn","btn-link"],[1,"invalid-feedback"],[1,"form-row","mb-3","mt-3"],[1,"form-group","col-12"],[1,"card"],[1,"card-header"],[1,"card-body"],[1,"d-flex","align-items-center","justify-content-between"],[1,"mr-3"],[2,"font-size","14px","padding","5px 10px"],["type","button",1,"btn","btn-sm",3,"click","disabled"],["class","spinner-border spinner-border-sm ml-1",4,"ngIf"],[1,"text-muted","mt-2","d-block"],[1,"spinner-border","spinner-border-sm","ml-1"],[1,"pt-3"],[1,"spinner-border","spinner-border-sm","mr-1"]],template:function(l,r){if(l&1){let E=T();n(0,"h1"),m(1,fe,2,0,"ng-container",1)(2,ve,1,0,"ng-template",null,0,B),i(),n(4,"form",2),M("ngSubmit",function(){return w(E),N(r.onSubmit())}),n(5,"div",3)(6,"div",4)(7,"label"),o(8,"Title"),i(),n(9,"select",5),c(10,"option",6),n(11,"option",7),o(12,"Mr."),i(),n(13,"option",8),o(14,"Mrs."),i(),n(15,"option",9),o(16,"Miss"),i(),n(17,"option",10),o(18,"Ms."),i()(),m(19,_e,2,1,"div",11),i()(),n(20,"div",3)(21,"div",12)(22,"label"),o(23,"First Name"),i(),c(24,"input",13),m(25,Ee,2,1,"div",11),i(),n(26,"div",12)(27,"label"),o(28,"Last Name"),i(),c(29,"input",14),m(30,be,2,1,"div",11),i()(),n(31,"div",3)(32,"div",15)(33,"label"),o(34,"Email"),i(),c(35,"input",16),m(36,xe,3,2,"div",11),i(),n(37,"div",4)(38,"label"),o(39,"Role"),i(),n(40,"select",17),c(41,"option",6),n(42,"option",18),o(43,"User"),i(),n(44,"option",19),o(45,"Admin"),i()(),m(46,Ie,2,1,"div",11),i()(),m(47,Ne,17,11,"div",20)(48,Te,5,0,"div",21),n(49,"div",3)(50,"div",4)(51,"label"),o(52,"Password"),i(),c(53,"input",22),m(54,qe,3,2,"div",11),i(),n(55,"div",4)(56,"label"),o(57,"Confirm Password"),i(),c(58,"input",23),m(59,Pe,3,2,"div",11),i()(),n(60,"div",24)(61,"button",25),m(62,Re,1,0,"span",26),o(63," Save "),i(),n(64,"a",27),o(65,"Cancel"),i()()()}if(l&2){let E=O(3);a(),d("ngIf",r.isAddMode)("ngIfElse",E),a(3),d("formGroup",r.form),a(5),d("ngClass",g(21,_,r.submitted&&r.f.title.errors)),a(10),d("ngIf",r.submitted&&r.f.title.errors),a(5),d("ngClass",g(23,_,r.submitted&&r.f.firstName.errors)),a(),d("ngIf",r.submitted&&r.f.firstName.errors),a(4),d("ngClass",g(25,_,r.submitted&&r.f.lastName.errors)),a(),d("ngIf",r.submitted&&r.f.lastName.errors),a(5),d("ngClass",g(27,_,r.submitted&&r.f.email.errors)),a(),d("ngIf",r.submitted&&r.f.email.errors),a(4),d("ngClass",g(29,_,r.submitted&&r.f.role.errors)),a(6),d("ngIf",r.submitted&&r.f.role.errors),a(),d("ngIf",!r.isAddMode&&r.account&&!r.isAdmin),a(),d("ngIf",!r.isAddMode),a(5),d("ngClass",g(31,_,r.submitted&&r.f.password.errors)),a(),d("ngIf",r.submitted&&r.f.password.errors),a(4),d("ngClass",g(33,_,r.submitted&&r.f.confirmPassword.errors)),a(),d("ngIf",r.submitted&&r.f.confirmPassword.errors),a(2),d("disabled",r.loading),a(),d("ngIf",r.loading)}},dependencies:[G,x,Q,Z,ee,H,Y,J,K,W,X,y],encapsulation:2})}}return e})();var Ve=[{path:"",component:de},{path:"add",component:L},{path:"edit/:id",component:L}],se=(()=>{class e{static{this.\u0275fac=function(l){return new(l||e)}}static{this.\u0275mod=A({type:e})}static{this.\u0275inj=S({imports:[q.forChild(Ve),q]})}}return e})();var it=(()=>{class e{static{this.\u0275fac=function(l){return new(l||e)}}static{this.\u0275mod=A({type:e})}static{this.\u0275inj=S({imports:[z,ie,se]})}}return e})();export{it as AccountsModule};
