import{Ja as w,a as i,b as u,c as g,d as b,f as h,g as k,ga as T,i as f,m as l,o as m}from"./chunk-ZYNGRVCC.js";var d={production:!1,apiUrl:"http://localhost:4000"};var s=`${d.apiUrl}/accounts`,p="currentAccount",R=(()=>{class r{constructor(t,e){this.router=t,this.http=e;let o=null;try{let a=localStorage.getItem(p);a&&(o=JSON.parse(a),console.log("Found saved account in localStorage"))}catch(a){console.error("Error loading account from localStorage:",a),localStorage.removeItem(p)}this.accountSubject=new b(o),this.account=this.accountSubject.asObservable(),o?.jwtToken&&(console.log("Starting refresh token timer for stored account"),this.startRefreshTokenTimer())}get accountValue(){return this.accountSubject.value}login(t,e){return this.http.post(`${s}/login`,{email:t,password:e},{withCredentials:!0}).pipe(h(o=>(this.storeAccount(o),this.startRefreshTokenTimer(),o)))}logout(){this.http.post(`${s}/logout`,{},{withCredentials:!0}).pipe(f(()=>{this.clearAccount()})).subscribe({error:t=>{console.error("Logout error:",t)}})}refreshToken(){return this.http.post(`${s}/refresh-token`,{},{withCredentials:!0}).pipe(h(t=>(this.storeAccount(t),this.startRefreshTokenTimer(),t)))}storeAccount(t){this.accountSubject.next(t),localStorage.setItem(p,JSON.stringify(t))}clearAccount(){this.stopRefreshTokenTimer(),this.accountSubject.next(null),localStorage.removeItem(p),this.router.navigate(["/account/login"])}register(t){return this.http.post(`${s}/register`,t)}verifyEmail(t){return this.http.post(`${s}/verify-email`,{token:t})}forgotPassword(t){return this.http.post(`${s}/forgot-password`,{email:t})}validateResetToken(t){return this.http.post(`${s}/validate-reset-token`,{token:t})}resetPassword(t,e,o){return this.http.post(`${s}/reset-password`,{token:t,password:e,confirmPassword:o})}getAll(){return this.http.get(s)}getById(t){return this.http.get(`${s}/${t}`)}create(t){return this.http.post(s,t)}update(t,e){return this.http.put(`${s}/${t}`,e).pipe(h(o=>(o.id===this.accountValue.id&&(o=i(i({},this.accountValue),o),this.storeAccount(o)),o)))}delete(t){return this.http.delete(`${s}/${t}`).pipe(f(()=>{t===this.accountValue.id&&this.logout()}))}resendVerificationEmail(t){return this.http.post(`${s}/resend-verification-email`,{email:t})}updateStatus(t,e){return this.http.patch(`${d.apiUrl}/accounts/${t}/status`,{isActive:e})}startRefreshTokenTimer(){if(this.accountValue?.jwtToken)try{let t=JSON.parse(atob(this.accountValue.jwtToken.split(".")[1])),e=new Date(t.exp*1e3),o=e.getTime()-Date.now()-60*1e3;console.log(`JWT token will expire at ${e.toLocaleString()}, refreshing in ${Math.round(o/1e3/60)} minutes`),this.refreshTokenTimeout=setTimeout(()=>{console.log("Refreshing token..."),this.refreshToken().subscribe({next:()=>console.log("Token refreshed successfully"),error:a=>console.error("Token refresh failed:",a)})},o)}catch(t){console.error("Error parsing JWT token for refresh timer:",t)}}stopRefreshTokenTimer(){clearTimeout(this.refreshTokenTimeout)}static{this.\u0275fac=function(e){return new(e||r)(m(w),m(T))}}static{this.\u0275prov=l({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var n=class{constructor(j){Object.assign(this,j)}},c=function(r){return r[r.Success=0]="Success",r[r.Error=1]="Error",r[r.Info=2]="Info",r[r.Warning=3]="Warning",r}(c||{});var v=function(r){return r.User="User",r.Admin="Admin",r}(v||{});var z=(()=>{class r{constructor(){this.subject=new g,this.defaultId="default-alert"}onAlert(t=this.defaultId){return this.subject.asObservable().pipe(k(e=>e&&e.id===t))}success(t,e){this.alert(new n(u(i({},e),{type:c.Success,message:t})))}error(t,e){this.alert(new n(u(i({},e),{type:c.Error,message:t})))}info(t,e){this.alert(new n(u(i({},e),{type:c.Info,message:t})))}warn(t,e){this.alert(new n(u(i({},e),{type:c.Warning,message:t})))}alert(t){t.id=t.id||this.defaultId,t.autoClose=t.autoClose===void 0?!0:t.autoClose,this.subject.next(t)}clear(t=this.defaultId){this.subject.next(new n({id:t}))}static{this.\u0275fac=function(e){return new(e||r)}}static{this.\u0275prov=l({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();export{d as a,R as b,c,v as d,z as e};
